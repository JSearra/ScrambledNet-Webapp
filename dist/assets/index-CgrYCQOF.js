(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const r={FREE:0,___L:1,__D_:2,__DL:3,_R__:4,_R_L:5,_RD_:6,_RDL:7,U___:8,U__L:9,U_D_:10,U_DL:11,UR__:12,UR_L:13,URD_:14,URDL:15,NONE:16},M={[r.___L]:"cable0001.png",[r.__D_]:"cable0010.png",[r.__DL]:"cable0011.png",[r._R__]:"cable0100.png",[r._R_L]:"cable0101.png",[r._RD_]:"cable0110.png",[r._RDL]:"cable0111.png",[r.U___]:"cable1000.png",[r.U__L]:"cable1001.png",[r.U_D_]:"cable1010.png",[r.U_DL]:"cable1011.png",[r.UR__]:"cable1100.png",[r.UR_L]:"cable1101.png",[r.URD_]:"cable1110.png",[r.URDL]:"cable1111.png"},x=[r.___L,r.__D_,r._R__,r.U___],L={[r.U___]:r.__D_,[r._R__]:r.___L,[r.__D_]:r.U___,[r.___L]:r._R__};class R{constructor(t,e,s){this.xindex=t,this.yindex=e,this.assets=s,this.connectedDirs=r.NONE,this.isConnected=!1,this.isFullyConnected=!1,this.isRoot=!1,this.isLocked=!1,this.isBlind=!1,this.solutionDirs=r.NONE,this.rotateTarget=0,this.rotateStart=0,this.rotateAngle=0,this.rotateTime=0,this.cellLeft=0,this.cellTop=0,this.cellWidth=0,this.cellHeight=0,this.nextU=null,this.nextD=null,this.nextL=null,this.nextR=null}reset(t){this.connectedDirs=t,this.isConnected=!1,this.isFullyConnected=!1,this.isRoot=!1,this.isLocked=!1,this.isBlind=!1,this.solutionDirs=r.NONE,this.rotateTarget=0,this.rotateAngle=0}setGeometry(t,e,s,i){this.cellLeft=t,this.cellTop=e,this.cellWidth=s,this.cellHeight=i}setNeighbours(t,e,s,i){this.nextU=t,this.nextD=e,this.nextL=s,this.nextR=i}next(t){switch(t){case r.U___:return this.nextU;case r._R__:return this.nextR;case r.__D_:return this.nextD;case r.___L:return this.nextL;default:return null}}dirs(){return this.connectedDirs}rotatedDirs(t){let e=this.connectedDirs;return t===90?e=(e&1)<<3|(e&14)>>1:t===-90?e=(e&8)>>3|(e&7)<<1:(t===180||t===-180)&&(e=(e&12)>>2|(e&3)<<2),e}hasConnection(t){return!this.isRotated()&&(this.connectedDirs&t)===t}isRotated(){return this.rotateTarget!==0}numDirs(){if(this.connectedDirs===r.NONE)return 0;let t=this.connectedDirs,e=0;for(let s=0;s<4;++s)e+=t&1,t>>=1;return e}addDir(t){(this.connectedDirs&t)!==t&&(this.connectedDirs|=t)}setDirs(t){this.connectedDirs=t}rotate(t,e){this.rotateTarget===0&&(this.rotateStart=performance.now(),this.rotateAngle=0,this.rotateTime=e),this.rotateTarget+=t}doUpdate(t){let e=!1;return this.rotateTarget!==0&&(this.rotateAngle=(t-this.rotateStart)/this.rotateTime*90,this.rotateTarget<0&&(this.rotateAngle=-this.rotateAngle),Math.abs(this.rotateAngle)>=90&&(this.rotateTarget>0?(this.setDirs(this.rotatedDirs(90)),this.rotateAngle>=this.rotateTarget?this.rotateAngle=this.rotateTarget=0:(this.rotateAngle-=90,this.rotateTarget-=90,this.rotateStart+=this.rotateTime)):(this.setDirs(this.rotatedDirs(-90)),this.rotateAngle<=this.rotateTarget?this.rotateAngle=this.rotateTarget=0:(this.rotateAngle+=90,this.rotateTarget+=90,this.rotateStart+=this.rotateTime)),e=!0)),e}draw(t){const e=this.cellLeft,s=this.cellTop,i=this.cellWidth,n=this.cellHeight;t.save(),t.translate(e+i/2,s+n/2);let o=null;if(this.connectedDirs===r.NONE?o="nothing.png":this.isLocked?o="background_locked.png":this.connectedDirs===r.FREE?o="empty.png":o="background.png",o){const a=this.assets.getImage(o);a&&t.drawImage(a,-i/2,-n/2,i,n)}if(t.rotate(this.rotateAngle*Math.PI/180),!this.isBlind&&this.connectedDirs!==r.NONE&&this.connectedDirs!==r.FREE){const a=M[this.connectedDirs],l=this.assets.getImage(a);l&&(!this.isConnected&&!this.isRoot&&(t.globalAlpha=.5),t.drawImage(l,-i/2,-n/2,i,n),t.globalAlpha=1)}if(t.rotate(-(this.rotateAngle*Math.PI)/180),this.isRoot){const a=this.assets.getImage("server.png");a&&t.drawImage(a,-i/2,-n/2,i,n)}else if(this.numDirs()===1){let a=null;this.isFullyConnected?a=this.assets.getImage("computer1.png"):a=this.assets.getImage("computer2.png"),this.isConnected||(t.globalAlpha=.5),a&&t.drawImage(a,-i/2,-n/2,i,n),t.globalAlpha=1}t.restore()}}class T{constructor(t){this.assets=t,this.gridWidth=10,this.gridHeight=10,this.cellMatrix=[],this.rootCell=null,this.isConnected=[],this.connectingCells=[],this.boardWidth=0,this.boardHeight=0,this.boardStartX=0,this.boardStartY=0,this.boardEndX=0,this.boardEndY=0,this.paddingX=0,this.paddingY=0,this.cellWidth=0,this.cellHeight=0}init(t,e){this.gridWidth=t,this.gridHeight=e,this.cellMatrix=new Array(t);for(let s=0;s<t;s++){this.cellMatrix[s]=new Array(e);for(let i=0;i<e;i++)this.cellMatrix[s][i]=new R(s,i,this.assets)}this.isConnected=new Array(t);for(let s=0;s<t;s++)this.isConnected[s]=new Array(e).fill(!1)}setSize(t,e){this.cellWidth=Math.floor(t/this.gridWidth),this.cellHeight=Math.floor(e/this.gridHeight),this.cellWidth%2!==0&&this.cellWidth--,this.cellHeight%2!==0&&this.cellHeight--,this.cellWidth<this.cellHeight?this.cellHeight=this.cellWidth:this.cellWidth=this.cellHeight,this.paddingX=Math.floor((t-this.gridWidth*this.cellWidth)/2),this.paddingY=Math.floor((e-this.gridHeight*this.cellHeight)/2);for(let s=0;s<this.gridWidth;++s)for(let i=0;i<this.gridHeight;++i){const n=s*this.cellWidth+this.paddingX,o=i*this.cellHeight+this.paddingY;this.cellMatrix[s][i].setGeometry(n,o,this.cellWidth,this.cellHeight)}}setupBoard(t,e,s){this.boardWidth=e,this.boardHeight=s,this.boardStartX=Math.floor((this.gridWidth-this.boardWidth)/2),this.boardEndX=this.boardStartX+this.boardWidth,this.boardStartY=Math.floor((this.gridHeight-this.boardHeight)/2),this.boardEndY=this.boardStartY+this.boardHeight;const i=t.wrapped;for(let n=0;n<this.gridWidth;n++)for(let o=0;o<this.gridHeight;o++){this.cellMatrix[n][o].reset(i?r.NONE:r.FREE);let a=null,l=null,h=null,c=null;(i||o>this.boardStartY)&&(a=this.cellMatrix[n][this.decr(o,this.boardStartY,this.boardEndY)]),(i||o<this.boardEndY-1)&&(l=this.cellMatrix[n][this.incr(o,this.boardStartY,this.boardEndY)]),(i||n>this.boardStartX)&&(h=this.cellMatrix[this.decr(n,this.boardStartX,this.boardEndX)][o]),(i||n<this.boardEndX-1)&&(c=this.cellMatrix[this.incr(n,this.boardStartX,this.boardEndX)][o]),this.cellMatrix[n][o].setNeighbours(a,l,h,c)}this.createNet(t);for(let n=this.boardStartX;n<this.boardEndX;n++)for(let o=this.boardStartY;o<this.boardEndY;o++)this.cellMatrix[n][o].solutionDirs=this.cellMatrix[n][o].connectedDirs;for(let n=this.boardStartX;n<this.boardEndX;n++)for(let o=this.boardStartY;o<this.boardEndY;o++){const a=Math.floor(Math.random()*4)-2;this.cellMatrix[n][o].rotate(a*90,0)}this.updateConnections()}decr(t,e,s){return t--,t<e&&(t=s-1),t}incr(t,e,s){return t++,t>=s&&(t=e),t}createNet(t){for(let n=this.boardStartX;n<this.boardEndX;n++)for(let o=this.boardStartY;o<this.boardEndY;o++)this.cellMatrix[n][o].setDirs(r.FREE),this.cellMatrix[n][o].isRoot=!1;const e=Math.floor(Math.random()*this.boardWidth)+this.boardStartX,s=Math.floor(Math.random()*this.boardHeight)+this.boardStartY;this.rootCell=this.cellMatrix[e][s],this.rootCell.isConnected=!0,this.rootCell.isRoot=!0;let i=[this.rootCell];for(;i.length>0;){const n=t.branches>=3?.5:.8;let o;Math.random()<n?o=i.length-1:o=Math.floor(Math.random()*i.length);const a=i[o],l=[];for(const h of x){const c=a.next(h);c&&c.connectedDirs===r.FREE&&l.push({dir:h,cell:c})}if(l.length===0)i.splice(o,1);else{const h=l[Math.floor(Math.random()*l.length)];a.addDir(h.dir),h.cell.addDir(L[h.dir]),i.push(h.cell)}}}updateConnections(){for(let e=0;e<this.gridWidth;e++)for(let s=0;s<this.gridHeight;s++)this.isConnected[e][s]=!1;let t=[];for(this.rootCell.isRotated()||(this.isConnected[this.rootCell.xindex][this.rootCell.yindex]=!0,t.push(this.rootCell));t.length>0;){const e=t.shift();for(const s of x)if(this.hasNewConnection(e,s)){const i=e.next(s);this.isConnected[i.xindex][i.yindex]=!0,t.push(i)}}for(let e=0;e<this.gridWidth;e++)for(let s=0;s<this.gridHeight;s++)this.cellMatrix[e][s].isConnected=this.isConnected[e][s]}hasNewConnection(t,e){const s=t.next(e);if(!s||this.isConnected[s.xindex][s.yindex])return!1;const i=L[e];return!(!t.hasConnection(e)||!s.hasConnection(i))}isSolved(){for(let t=this.boardStartX;t<this.boardEndX;t++)for(let e=this.boardStartY;e<this.boardEndY;e++){const s=this.cellMatrix[t][e];if(s.numDirs()===1&&!s.isConnected)return!1}return!0}handleInput(t,e){for(let s=0;s<this.gridWidth;s++)for(let i=0;i<this.gridHeight;i++){const n=this.cellMatrix[s][i];if(t>=n.cellLeft&&t<n.cellLeft+n.cellWidth&&e>=n.cellTop&&e<n.cellTop+n.cellHeight&&n.connectedDirs!==r.NONE&&n.connectedDirs!==r.FREE&&!n.isLocked)return n.rotate(90,250),this.assets.playSound("click.ogg"),!0}return!1}update(t){let e=!1;for(let s=0;s<this.gridWidth;++s)for(let i=0;i<this.gridHeight;++i)this.cellMatrix[s][i].doUpdate(t)&&(e=!0);return e&&(this.updateConnections(),this.isSolved())?"WIN":null}draw(t){for(let e=0;e<this.gridWidth;++e)for(let s=0;s<this.gridHeight;++s)this.cellMatrix[e][s].draw(t)}autoSolve(){for(let t=this.boardStartX;t<this.boardEndX;t++)for(let e=this.boardStartY;e<this.boardEndY;e++){const s=this.cellMatrix[t][e];s.connectedDirs=s.solutionDirs,s.rotateTarget=0,s.rotateAngle=0}return this.updateConnections(),"Solved!"}}class C{constructor(){this.images={},this.sounds={},this.toLoad=0,this.loaded=0,this.muted=!1,this.theme="modern"}setTheme(t){return this.theme=t,this.loaded=0,this.toLoad=0,this.loadAll()}loadImage(t){this.toLoad++;const e=new Image,s=this.theme==="modern"?"assets/images/":"assets/";e.src=`${s}${t}`,e.onload=()=>{this.loaded++},e.onerror=i=>{console.error("Failed to load image",t,i),this.loaded++},this.images[t]=e}loadSound(t){this.toLoad++;const e=new Audio(`assets/audio/${t}`);e.onloadeddata=()=>{this.loaded++},e.onerror=s=>{console.error("Failed to load sound",t,s),this.loaded++},this.sounds[t]=e}loadAll(){const t=["background.png","background_locked.png","empty.png","nothing.png","server.png","computer1.png","computer2.png","cable0001.png","cable0010.png","cable0011.png","cable0100.png","cable0101.png","cable0110.png","cable0111.png","cable1000.png","cable1001.png","cable1010.png","cable1011.png","cable1100.png","cable1101.png","cable1110.png","cable1111.png"];return this.theme==="retro"&&(this.loadImage("game_background.png"),this.loadImage("splash_bg.jpg")),t.forEach(e=>this.loadImage(e)),Object.keys(this.sounds).length===0&&["click.ogg","win.ogg"].forEach(s=>this.loadSound(s)),new Promise(e=>{const s=Date.now(),i=()=>{this.toLoad>0&&this.loaded>=this.toLoad?e():Date.now()-s>3e3?(console.warn("Asset loading timed out, forcing start"),e()):requestAnimationFrame(i)};i()})}getImage(t){return this.images[t]}playSound(t){if(this.muted)return;const e=this.sounds[t];e&&(e.currentTime=0,e.play().catch(s=>console.log("Audio play blocked",s)))}}const f={NOVICE:{label:"Novice",branches:2,wrapped:!1,blind:9},NORMAL:{label:"Normal",branches:2,wrapped:!1,blind:9},EXPERT:{label:"Expert",branches:2,wrapped:!1,blind:9},MASTER:{label:"Master",branches:3,wrapped:!0,blind:9},INSANE:{label:"Insane",branches:3,wrapped:!0,blind:3}},m={HUGE:{major:10,minor:7,expert_major:8,expert_minor:6,normal_major:6,normal_minor:5,novice_major:5,novice_minor:5}};function S(d,t,e){let s,i;return d==="NOVICE"?(s=m.HUGE.novice_major,i=m.HUGE.novice_minor):d==="NORMAL"?(s=m.HUGE.normal_major,i=m.HUGE.normal_minor):d==="EXPERT"?(s=m.HUGE.expert_major,i=m.HUGE.expert_minor):(s=m.HUGE.major,i=m.HUGE.minor),t>e?{width:s,height:i}:{width:i,height:s}}class A{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.assets=new C,this.board=new T(this.assets),this.running=!1,this.lastTime=0,this.currentSkill=null,this.moves=0,this.startTime=0,this.canvas.addEventListener("mousedown",e=>this.handleInput(e)),this.canvas.addEventListener("touchstart",e=>{if(e.preventDefault(),e.changedTouches.length>0){const s=e.changedTouches[0],i=this.canvas.getBoundingClientRect(),n=s.clientX-i.left,o=s.clientY-i.top;this.board.handleInput(n,o)}},{passive:!1})}stop(){this.running=!1}toggleSound(){return this.assets.muted=!this.assets.muted,!this.assets.muted}async start(t){this.currentSkill=t,this.running=!1,this.assets.loaded<1&&await this.assets.loadAll(),this.moves=0,this.startTime=Date.now(),this.resize(),S(t.label.toUpperCase(),1e3,1e3);const e=this.canvas.parentElement,s=e.clientWidth,i=e.clientHeight,n=S(t.label.toUpperCase(),s,i);this.board.init(n.width,n.height),this.board.setSize(this.canvas.width,this.canvas.height),this.board.setupBoard(t,n.width,n.height),this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(o=>this.loop(o)),document.getElementById("message").innerText="You Win!"}resize(){const t=this.canvas.parentElement;this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight,this.board&&this.board.cellMatrix.length>0&&this.board.setSize(this.canvas.width,this.canvas.height)}handleInput(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.board.handleInput(s,i)&&this.running&&this.moves++}loop(t){if(!this.running)return;t-this.lastTime;const e=this.board.update(t);this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.board.draw(this.ctx);const s=Date.now(),i=Math.floor((s-this.startTime)/1e3),n=Math.floor(i/60),o=i%60,a=`${n}:${o.toString().padStart(2,"0")}`;document.getElementById("time-display").innerText=a,document.getElementById("moves-display").innerText=this.moves,e==="WIN"&&(this.assets.playSound("win.ogg"),this.running=!1,document.getElementById("final-time").innerText=a,document.getElementById("final-moves").innerText=this.moves,document.getElementById("ui-overlay").classList.remove("hidden")),this.lastTime=t,requestAnimationFrame(l=>this.loop(l))}}window.addEventListener("load",()=>{const d=document.getElementById("game-canvas"),t=new A(d);window.game=t;const e=document.getElementById("start-screen"),s=document.getElementById("game-screen"),i=document.getElementById("ui-overlay"),n=document.getElementById("back-btn"),o=document.getElementById("play-again-btn"),a=document.getElementById("menu-btn");function l(g){e.classList.add("hidden"),s.classList.add("hidden"),g.classList.remove("hidden")}function h(g){l(s),i.classList.add("hidden"),t.start(g),setTimeout(()=>t.resize(),50)}function c(){t.stop(),l(e)}document.getElementById("skill-novice").addEventListener("click",()=>h(f.NOVICE)),document.getElementById("skill-normal").addEventListener("click",()=>h(f.NORMAL)),document.getElementById("skill-expert").addEventListener("click",()=>h(f.EXPERT)),document.getElementById("skill-master").addEventListener("click",()=>h(f.MASTER)),document.getElementById("skill-insane").addEventListener("click",()=>h(f.INSANE)),n.addEventListener("click",()=>{c()}),o.addEventListener("click",()=>{i.classList.add("hidden"),t.start(t.currentSkill)}),a.addEventListener("click",()=>{i.classList.add("hidden"),c()});const D=document.getElementById("instructions-btn"),p=document.getElementById("instructions-screen"),I=document.getElementById("instructions-back-btn");D.addEventListener("click",()=>{p.classList.remove("hidden")}),I.addEventListener("click",()=>{p.classList.add("hidden")});const v=document.getElementById("settings-btn"),b=document.getElementById("settings-screen"),w=document.getElementById("settings-close-btn"),E=document.getElementById("setting-sound"),_=document.getElementById("setting-theme");v.addEventListener("click",()=>{b.classList.remove("hidden"),E.checked=!t.assets.muted,_.value=t.assets.theme}),w.addEventListener("click",()=>{b.classList.add("hidden")}),E.addEventListener("change",g=>{t.assets.muted=!g.target.checked}),_.addEventListener("change",g=>{const u=g.target.value;u!==t.assets.theme&&t.assets.setTheme(u).then(()=>{s.classList.contains("hidden")||t.draw(),y(u),console.log("Theme switched to",u)})});function y(g){const u=document.getElementById("game-container");g==="retro"?(u.style.backgroundImage="url('assets/empty.png')",u.style.backgroundSize="auto"):(u.style.backgroundImage="",u.style.backgroundSize="")}window.addEventListener("resize",()=>{s.classList.contains("hidden")||t.resize()}),y(t.assets.theme),l(e)});
